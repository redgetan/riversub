<div class="background"></div>
<div class='group_show_container container'>
  <div class='row center group_header'>
    <div class="col-xs-12">
      <div id='avatar' >
        <% if user_signed_in? && can?(:edit, @group) %>
          <div class="thumbnail" data-toggle="tooltip" title="change avatar" data-placement="left">
            <a href="<%= edit_group_path(@group) %>">
              <%= image_tag @group.avatar.url  %>
            </a>
          </div>
        <% else %>
          <div class="thumbnail">
            <%= image_tag @group.avatar.url  %>
          </div>
        <% end %>
      </div>
      <span class="title river_gray"><%= @group.name %></span>
      <p>
        <%= @group.description %>
      </p>
      <% if can?(:edit, @group) %>
        <p>
          <span>[<%= link_to 'Edit', edit_group_path(@group) %>]</span>
        </p>
      <% end %>
    </div>
  </div>

  <div class='row'>
    <div class="left_column col-md-3 col-md-offset-1 col-xs-12 col-xs-offset-0">
      <div class='action_container section_block <%= @group.is_member?(current_user) ? "joined" : "" %>'>
        <div class="section_body">
          <div class=''>
            <% if @group.is_member?(current_user) %>
              <a href="#" data-toggle="modal" data-target="#subtitle_modal" class="subtitle_video_btn ">Subtitle a Video</a>
              <a href="<%= @group.new_request_url %>" class="request_btn ">Request Subtitle</a>
            <% else %>
              <%= link_to "Join Group", @group.join_url, method: "post", class: "join_group_btn" %>
            <% end %>
          </div>
        </div>
      </div>
      <% if @group.short_name == "jpweekly" %>
        <div class='rules_container'>
          <div class="section_block">
            <div class="section_header">
              Rules
            </div>
            <div class="section_body">
              <ol>
                <li>Video must be < 10 minutes</li>
                <li>No movies/tv shows</li>
                <li>Japanese Videos only</li>
              </ol>
            </div>
          </div>
        </div>
      <% end %>
      <div class='latest_activity_container'>
        <div class="section_block">
          <div class="section_header">
            Activity
          </div>
          <div class="section_body">
            <%= render_activities(@activities) %>
          </div>
        </div>
      </div>
      <div class='members_container'>
        <div class="section_block">
          <div class="section_header">
            Members
          </div>
          <div class="section_body">
            <% @group.members.each do |member| %>
              <div class='member ' data-toggle="tooltip" title="<%= member.username %>">
                <a class="user_avatar" href="<%= member.url %>">
                  <%= image_tag member.avatar_url %>
                </a>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <div class="right_column col-md-7 col-xs-12">
      <div class='group_requests section_block'>
        <div class="section_header">
          Requests
        </div>
        <div class="section_body">

          <ul class="">
            <% if @group.requests.present? %>
              <li class='group_requests_header'>
                <span class='col-xs-6'>Title</span>
                <span class='col-xs-2'>Language</span>
                <span class='col-xs-2'>Actions</span>
                <span class='col-xs-2'>Status</span>
              </li>
              <% @group.requests.each do |request| %>
                <li>
                  <a class='col-xs-6' href="<%= request.video.source_url %>"><%= request.video.title %></a>
                  <span class='col-xs-2 request_langauge'><%= request.language_pretty %></span>
                  <div class='col-xs-2 request_actions'>
                    <a class='subtitle_request_btn' href="<%= request.new_repository_url %>">[Subtitle]</a>
                  </div>
                  <% if request.completed? %>
                    <a class='request_status col-xs-2' href='<%= request.completed_repository.url %>'>Done</a>
                  <% end %>
                </li>
              <% end %>
            <% else %>
              <div class='empty_request_notice'>
                There's currently nothing here. <a href="<%= @group.new_request_url %>" class="group_request_add_btn">Add Request</a> 
              </div>
            <% end %>
          </ul>
        </div>
      </div>

      <div class='groups_videos videos videos_container section_block'>
        <div class="home_try section_body">
          <% @group_repos.each_slice(4) do |repos| %>
            <%= render partial: "repositories/list", locals: {repos: repos, repo_width: "col-md-3"}  %>
          <% end %>
        </div>
        <%= paginate @group_repos %>
      </div>
    </div>
  </div>
</div>

<div id="subtitle_modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="subtitle_modal_label" aria-hidden="true">
  <div class="modal-backdrop fade in" style="height: 984px;"></div>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
        <form class="sub">
          <%= hidden_field_tag :group_id, @group.short_name %>
          <%= hidden_field_tag :hide_group, true %>
          <div class="subtitle_video_container input-group">
            <div class="input-append">
              <input name="source_url" class="source_url" type="text" placeholder="Paste youtube url">
              <button type="button" class="river_btn sub_btn" data-loading-text="Loading...">Start</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

